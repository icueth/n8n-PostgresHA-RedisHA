{
    "$schema": "https://railway.app/railway.schema.json",
    "name": "n8n Enterprise-Ready Stack",
    "description": "Self-hosted Zapier Alternative with Infinite Scaling - n8n + PostgreSQL HA + Redis",
    "icon": "https://raw.githubusercontent.com/n8n-io/n8n/master/assets/n8n-logo.png",
    "params": {
        "POSTGRES_PASSWORD": {
            "description": "PostgreSQL password for database connections",
            "label": "PostgreSQL Password",
            "config": {
                "length": 32
            }
        },
        "REDIS_PASSWORD": {
            "description": "Redis password for cache and queue connections",
            "label": "Redis Password",
            "config": {
                "length": 32
            }
        },
        "N8N_ENCRYPTION_KEY": {
            "description": "Encryption key for n8n credentials (keep this secret!)",
            "label": "n8n Encryption Key",
            "config": {
                "length": 32
            }
        },
        "N8N_USER_MANAGEMENT_JWT_SECRET": {
            "description": "JWT secret for n8n user authentication",
            "label": "n8n JWT Secret",
            "config": {
                "length": 64
            }
        },
        "N8N_TASKS_RUNNER_AUTH_TOKEN": {
            "description": "Authentication token for the external task runner",
            "label": "n8n Task Runner Auth Token",
            "config": {
                "length": 32
            }
        }
    },
    "services": {
        "postgres-18-primary": {
            "source": {
                "directory": "postgresql-18-ha"
            },
            "env": {
                "NODE_ROLE": "PRIMARY",
                "PGDATA": "/var/lib/postgresql/data/pgdata",
                "POSTGRES_PASSWORD": "${{POSTGRES_PASSWORD}}"
            },
            "mounts": [
                {
                    "mountPath": "/var/lib/postgresql/data",
                    "volume": "postgres-18-primary-data"
                }
            ]
        },
        "postgres-18-replica": {
            "source": {
                "directory": "postgresql-18-ha"
            },
            "env": {
                "NODE_ROLE": "REPLICA",
                "PGDATA": "/var/lib/postgresql/data/pgdata",
                "POSTGRES_PASSWORD": "${{POSTGRES_PASSWORD}}",
                "PRIMARY_HOST": "${{postgres-18-primary.RAILWAY_PRIVATE_DOMAIN}}"
            },
            "mounts": [
                {
                    "mountPath": "/var/lib/postgresql/data",
                    "volume": "postgres-18-replica-data"
                }
            ]
        },
        "postgres-18-proxy": {
            "source": {
                "directory": "postgresql-18-ha"
            },
            "env": {
                "NODE_ROLE": "PROXY",
                "POSTGRES_PASSWORD": "${{POSTGRES_PASSWORD}}",
                "PRIMARY_HOST": "${{postgres-18-primary.RAILWAY_PRIVATE_DOMAIN}}",
                "REPLICA_HOST": "${{postgres-18-replica.RAILWAY_PRIVATE_DOMAIN}}"
            }
        },
        "Redis-n8n": {
            "source": {
                "directory": "redis"
            },
            "env": {
                "REDIS_PASSWORD": "${{REDIS_PASSWORD}}"
            },
            "mounts": [
                {
                    "mountPath": "/data",
                    "volume": "redis-data"
                }
            ]
        },
        "n8n": {
            "source": {
                "directory": "n8n"
            },
            "env": {
                "DB_TYPE": "postgresdb",
                "DB_POSTGRESDB_HOST": "${{postgres-18-proxy.RAILWAY_PRIVATE_DOMAIN}}",
                "DB_POSTGRESDB_PORT": "5432",
                "DB_POSTGRESDB_DATABASE": "n8n",
                "DB_POSTGRESDB_USER": "postgres",
                "DB_POSTGRESDB_PASSWORD": "${{POSTGRES_PASSWORD}}",
                "DB_POSTGRESDB_SSL_ENABLED": "false",
                "EXECUTIONS_MODE": "queue",
                "QUEUE_BULL_REDIS_HOST": "${{Redis-n8n.RAILWAY_PRIVATE_DOMAIN}}",
                "QUEUE_BULL_REDIS_PORT": "6379",
                "QUEUE_BULL_REDIS_PASSWORD": "${{REDIS_PASSWORD}}",
                "QUEUE_HEALTH_CHECK_ACTIVE": "true",
                "N8N_ENCRYPTION_KEY": "${{N8N_ENCRYPTION_KEY}}",
                "N8N_USER_MANAGEMENT_JWT_SECRET": "${{N8N_USER_MANAGEMENT_JWT_SECRET}}",
                "N8N_SECURE_COOKIE": "true",
                "N8N_PROTOCOL": "https",
                "N8N_HOST": "${{RAILWAY_PUBLIC_DOMAIN}}",
                "WEBHOOK_URL": "https://${{RAILWAY_PUBLIC_DOMAIN}}/",
                "GENERIC_TIMEZONE": "Asia/Bangkok",
                "TZ": "Asia/Bangkok",
                "N8N_METRICS": "true",
                "N8N_DIAGNOSTICS_ENABLED": "false",
                "N8N_VERSION_NOTIFICATIONS_ENABLED": "false",
                "N8N_TEMPLATES_ENABLED": "true",
                "N8N_HIRING_BANNER_ENABLED": "false",
                "EXECUTIONS_DATA_PRUNE": "true",
                "EXECUTIONS_DATA_MAX_AGE": "168",
                "EXECUTIONS_DATA_SAVE_ON_ERROR": "all",
                "EXECUTIONS_DATA_SAVE_ON_SUCCESS": "all",
                "EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS": "true",
                "N8N_LOG_LEVEL": "info",
                "N8N_RUNNERS_ENABLED": "true",
                "N8N_RUNNERS_MODE": "external",
                "N8N_RUNNERS_AUTH_TOKEN": "${{N8N_TASKS_RUNNER_AUTH_TOKEN}}",
                "N8N_RUNNERS_BROKER_LISTEN_ADDRESS": "0.0.0.0",
                "N8N_NATIVE_PYTHON_RUNNER": "true",
                "OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS": "true"
            }
        },
        "n8n-worker": {
            "source": {
                "directory": "n8n-worker"
            },
            "env": {
                "DB_TYPE": "postgresdb",
                "DB_POSTGRESDB_HOST": "${{postgres-18-proxy.RAILWAY_PRIVATE_DOMAIN}}",
                "DB_POSTGRESDB_PORT": "5432",
                "DB_POSTGRESDB_DATABASE": "n8n",
                "DB_POSTGRESDB_USER": "postgres",
                "DB_POSTGRESDB_PASSWORD": "${{POSTGRES_PASSWORD}}",
                "DB_POSTGRESDB_SSL_ENABLED": "false",
                "EXECUTIONS_MODE": "queue",
                "QUEUE_BULL_REDIS_HOST": "${{Redis-n8n.RAILWAY_PRIVATE_DOMAIN}}",
                "QUEUE_BULL_REDIS_PORT": "6379",
                "QUEUE_BULL_REDIS_PASSWORD": "${{REDIS_PASSWORD}}",
                "N8N_ENCRYPTION_KEY": "${{N8N_ENCRYPTION_KEY}}",
                "GENERIC_TIMEZONE": "Asia/Bangkok",
                "TZ": "Asia/Bangkok",
                "N8N_CONCURRENCY_PRODUCTION_LIMIT": "10",
                "N8N_LOG_LEVEL": "info",
                "N8N_RUNNERS_ENABLED": "true",
                "N8N_RUNNERS_MODE": "external",
                "N8N_RUNNERS_AUTH_TOKEN": "${{N8N_TASKS_RUNNER_AUTH_TOKEN}}",
                "N8N_RUNNERS_BROKER_LISTEN_ADDRESS": "0.0.0.0",
                "N8N_NATIVE_PYTHON_RUNNER": "true",
                "OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS": "true"
            }
        },
        "n8n-task-runner": {
            "source": {
                "directory": "n8n-task-runner"
            },
            "env": {
                "N8N_RUNNERS_AUTH_TOKEN": "${{N8N_TASKS_RUNNER_AUTH_TOKEN}}",
                "N8N_RUNNERS_TASK_BROKER_URI": "http://${{n8n.RAILWAY_PRIVATE_DOMAIN}}:5679"
            }
        }
    }
}